# Las Fases de un Escaneo de Nmap

Ahora que hemos visto algunas aplicaciones de Nmap, veamos qué sucede cuando se ejecuta un escaneo de Nmap. Los escaneos proceden en fases, y cada fase termina antes de que comience la siguiente. Como puede ver en las descripciones de las fases a continuación, hay mucho más en Nmap que solo el escaneo de puertos.

**Pre-escaneo de scripts.** El Nmap Scripting Engine (NSE) utiliza una colección de scripts de propósito especial para obtener más información sobre sistemas remotos. NSE no se ejecuta a menos que lo solicite con opciones como `--script` o `-sC`, y la fase de pre-escaneo solo ocurre cuando se seleccionan scripts que la necesitan. Esta fase es para scripts que solo necesitan ejecutarse una vez por ejecución de Nmap en lugar de ejecutarse por separado contra objetivos individuales. Ejemplos incluyen `dhcp-discover` y `broadcast-dns-service-discovery`, que utilizan consultas de difusión para obtener información de servicios de red comunes. NSE está completamente documentado en el Capítulo 9, y las diferentes fases se cubren en la sección llamada "Tipos y Fases de Scripts".

**Enumeración de objetivos.** En esta fase, Nmap investiga los especificadores de host proporcionados por el usuario, que pueden ser una combinación de nombres DNS de host, direcciones IP, notaciones de red CIDR y más. ¡Incluso puede usar (`-iR`) para pedirle a Nmap que elija sus objetivos por usted! Nmap resuelve estos especificadores en una lista de direcciones IPv4 o IPv6 para escanear. Esta fase no se puede omitir ya que es esencial para el escaneo posterior, pero puede simplificar el procesamiento pasando solo direcciones IP para que Nmap no tenga que hacer resolución directa. Si pasa las opciones `-sL -n` (escaneo de lista sin resolución DNS inversa), Nmap imprimirá los objetivos y no realizará más escaneos. Esta fase se discute en la sección llamada "Especificación de Hosts y Redes Objetivo" y la sección llamada "Escaneo de Lista (-sL)".

**Descubrimiento de hosts (escaneo de ping).** Los escaneos de red generalmente comienzan descubriendo qué objetivos en la red están en línea y, por lo tanto, merecen una investigación más profunda. Este proceso se llama descubrimiento de hosts o escaneo de ping. Nmap ofrece muchas técnicas de descubrimiento de hosts, que van desde solicitudes ARP rápidas hasta combinaciones elaboradas de TCP, ICMP y otros tipos de sondas. Esta fase se ejecuta de forma predeterminada, aunque puede omitirla (simplemente asumiendo que todas las IP de destino están en línea) usando la opción `-Pn` (sin ping). Para salir después del descubrimiento de hosts, especifique `-sn -n`. El descubrimiento de hosts es el tema del Capítulo 3.

**Resolución DNS inversa.** Una vez que Nmap ha determinado qué hosts escanear, busca los nombres DNS inversos de todos los hosts encontrados en línea por el escaneo de ping. A veces, el nombre de un host proporciona pistas sobre su función, y los nombres hacen que los informes sean más legibles que proporcionar solo números IP. Este paso puede omitirse con la opción `-n` (sin resolución), o ampliarse para cubrir todas las IP de destino (incluso las inactivas) con `-R` (resolver todo). La resolución de nombres se cubre en la sección llamada "Resolución DNS".

**Escaneo de puertos.** Esta es la operación central de Nmap. Se envían sondas y las respuestas (o la falta de ellas) a esas sondas se utilizan para clasificar los puertos remotos en estados como abierto, cerrado o filtrado. Esa breve descripción no comienza a abarcar los muchos tipos de escaneo de Nmap, la configurabilidad de los escaneos y los algoritmos para mejorar la velocidad y la precisión. Una descripción general del escaneo de puertos se encuentra en el Capítulo 4. La información detallada sobre algoritmos y opciones de línea de comandos se encuentra en el Capítulo 5. El escaneo de puertos se realiza de forma predeterminada, aunque puede omitirlo con la opción `-sn` y aún realizar algunas de las fases posteriores de traceroute y parciales del Nmap Scripting Engine especificando sus opciones de línea de comandos particulares (como `--traceroute` y `--script`).

**Detección de versiones.** Si se encuentra que algún puerto está abierto, Nmap puede ser capaz de determinar qué software de servidor se está ejecutando en el sistema remoto. Hace esto enviando una variedad de sondas a los puertos abiertos y comparando cualquier respuesta con una base de datos de miles de más de 6,500 firmas de servicios conocidos. La detección de versiones se habilita con la opción `-sV` y se describe completamente en el Capítulo 7.

**Detección de SO.** Si se solicita con la opción `-O`, Nmap procede a la detección de SO. Los diferentes sistemas operativos implementan estándares de red de maneras sutilmente diferentes. Al medir estas diferencias, a menudo es posible determinar el sistema operativo que se ejecuta en un host remoto. Nmap compara las respuestas a un conjunto estándar de sondas con una base de datos de más de mil respuestas de sistemas operativos conocidos. La detección de SO se cubre en el Capítulo 8.

**Traceroute.** Nmap contiene una implementación optimizada de traceroute, habilitada por la opción `--traceroute`. Puede encontrar las rutas de red a muchos hosts en paralelo, utilizando los mejores paquetes de sonda disponibles según lo determinado por las fases de descubrimiento anteriores de Nmap. Traceroute generalmente implica otra ronda de resolución DNS inversa para los hosts intermedios. Se encuentra más información en la sección llamada "Descubrimiento de Hosts".

**Escaneo de scripts.** La mayoría de los scripts de Nmap Scripting Engine (NSE) se ejecutan durante esta fase principal de escaneo de scripts, en lugar de las fases de pre-escaneo y post-escaneo. NSE está impulsado por el lenguaje de programación Lua y una biblioteca estándar diseñada para la recopilación de información de red. Los scripts que se ejecutan durante esta fase generalmente se ejecutan una vez para cada host de destino y número de puerto con el que interactúan. Comúnmente realizan tareas como detectar vulnerabilidades de servicios, descubrimiento de malware, recopilación de más información de bases de datos y otros servicios de red, y detección avanzada de versiones. NSE no se ejecuta a menos que lo solicite con opciones como `--script` o `-sC`.

**Salida.** Finalmente, Nmap recopila toda la información que ha reunido y la escribe en la pantalla o en un archivo. Nmap puede escribir la salida en varios formatos. Su formato predeterminado, legible por humanos (formato interactivo), generalmente se presenta en este libro. Nmap también ofrece un formato de salida basado en XML, entre otros. Los detalles de la salida son el tema del Capítulo 13.

Como ya se discutió, Nmap ofrece muchas opciones para controlar cuáles de estas fases se ejecutan. Para escaneos de grandes redes, cada fase se repite muchas veces ya que Nmap trata con los hosts en grupos más pequeños. Escanea cada grupo completamente y genera esos resultados, luego pasa al siguiente lote de hosts.

**Post-escaneo de scripts.** Después de que Nmap haya completado su escaneo y salida normal, los scripts en esta fase pueden procesar los resultados y entregar informes finales y estadísticas. Consulte la sección llamada "Tipos y Fases de Scripts". Nmap aún no incluye ningún script en esta fase, por lo que solo se ejecuta si el usuario incluye y ejecuta sus propios scripts de post-escaneo.
